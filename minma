name: 🔁 Minimal Pre-Chamber Test

on:
  push:
    branches: [ main ]
    paths:
      - 'CustomerVPC/terraform/config/envs/**'

jobs:
  pre_chamber_deployment:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: 🧠 Generate changed_files.txt
        run: |
          mkdir -p tmp
          echo "Detecting changed files..."
          if [ -n "${{ github.event.before }}" ]; then
            git diff --name-only ${{ github.event.before }} ${{ github.sha }} > tmp/changed_files.txt
          else
            git diff --name-only HEAD~1..HEAD > tmp/changed_files.txt
          fi
          cat tmp/changed_files.txt

      - name: 💾 Cache changed files
        uses: actions/cache@v3
        with:
          path: tmp/changed_files.txt
          key: changed-files-${{ github.sha }}

      - name: 📂 Extract cc_chdir from changed files
        run: |
          echo "Checking tfvars location:"
          cc_chdir=$(grep 'tfvars.json' tmp/changed_files.txt | head -n1 | cut -d '/' -f 5-7)
          echo "🟢 Extracted cc_chdir: $cc_chdir"






mkdir -p CustomerVPC/terraform/config/envs/prod/aws-test01
echo '{}' > CustomerVPC/terraform/config/envs/prod/aws-test01/t001.tfvars.json
git add .
git commit -m "Test change to trigger workflow"
git push
